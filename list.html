<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta content="yes" name="apple-mobile-web-app-capable">
    <meta name="viewport"
        content="width=device-width,height=device-height,initial-scale=1.0,maximum-scale=1.0,user-scalable=no">
    <!-- import CSS -->
    <link rel="icon" type="image/x-icon" href="yanferr.ico" />
    <link rel="stylesheet" href="css/index.css">
    <title>看嘛！</title>
</head>

<body>
    <div id="app">
        <div class="search" @dblclick="dblclick" style="z-index:999;margin:0px auto;">
            <input @keyup.esc="esc" v-model="search" @keyup.enter="enter" class="search" />
        </div>
        <el-card v-if="!isPhone" shadow="always" :class="{'box-card-windows':!isPhone,'box-card-phone':isPhone}">
            <el-table :show-header="false" @select="selectChange" @row-dblclick="rowClick" stripe :data="tableData"
                style="width: 100%">
                <el-table-column :show-overflow-tooltip="true" type="selection" width="30">
                </el-table-column>
                <el-table-column :show-overflow-tooltip="true" prop="ques">
                </el-table-column>
                <!-- <el-table-column v-show="false" prop="createTime" width="98px">
                </el-table-column> -->
            </el-table>
        </el-card>
        <el-table v-if="isPhone" :show-header="false" @select="selectChange" @row-dblclick="rowClick" stripe
            :data="tableData" style="width: 100%">
            <el-table-column :show-overflow-tooltip="true" type="selection" width="30">
            </el-table-column>
            <el-table-column :show-overflow-tooltip="true" prop="ques">
            </el-table-column>
            <!-- <el-table-column v-show="false" prop="createTime" width="98px">
                </el-table-column> -->
        </el-table>
        <el-drawer size="35%" :with-header="false" :visible.sync="drawer" :direction="direction">
            <el-input class="inputQues" placeholder="输入问题" v-model="ques">
            </el-input>
            <br><br>
            <br>
            <el-radio-group v-if="isPhone" v-model="scene" size="small">
                <el-radio-button label="interv"></el-radio-button>
                <el-radio-button label="daily"></el-radio-button>
                <el-radio-button label="debug"></el-radio-button>
                <el-radio-button label="book"></el-radio-button>
                <el-radio-button label="other"></el-radio-button>
            </el-radio-group>
            <el-radio-group v-if="!isPhone" v-model="scene" size="medium">
                <el-radio-button label="interv"></el-radio-button>
                <el-radio-button label="daily"></el-radio-button>
                <el-radio-button label="debug"></el-radio-button>
                <el-radio-button label="book"></el-radio-button>
                <el-radio-button label="other"></el-radio-button>
            </el-radio-group>
            <br><br>
            <br>
            <el-input :rows="10" type="textarea" placeholder="输入答案" v-model="answer">
            </el-input>
            <div @click="clickToSubmit" class="submitdiv"></div>
            <el-backtop target=".page-component__scroll .el-scrollbar__wrap">
            </el-backtop>
        </el-drawer>
    </div>
</body>
<script src="./js/axios.min.js"></script>
<script src="./js/vue.js"></script>
<script src="./js/index.js"></script>
<script src="./js/jquery-1.11.3.js"></script>
<script>
    new Vue({
        el: '#app',
        data() {
            //这里存放数据
            return {
                search: "",
                direction: "",
                drawer: false,
                search: '',
                tableData: [],
                quesId: null,
                answerId: null,
                ques: "",
                answer: "",
                scene: "interv",
                isPhone: false,
                pageIndex: -1, // 当前页为新增页
                showFixedSearch: false,
                selectIds: [] // 选中的row
            };
        },

        methods: {
            selectChange(selected) {
                this.selectIds = [];
                for (var i = 0; i < selected.length; i++) {
                    this.selectIds.push(selected[i].quesId);
                }
            },
            // input监听enter
            enter() {
                if (this.search === "del") {
                    console.log(this.selectIds);
                    this.deleteBatch();
                } else {  // 如果是数字，包括小数点
                    this.searchQ();
                }
            },
            searchQ() {
                axios.get('http://yanferr.com:8080/qa/ques/search', {
                        params: {
                            search: this.search,
                        }
                    })
                    .then(response => {
                        console.log(response)
                        this.tableData = response.data.data;
                        console.log(this.tableData)
                    })
                    .catch(function (error) { // 请求失败处理
                        console.log(error);
                    });
            },
            deleteBatch() {
                if (this.selectIds.length === 0) {
                    this.$message({
                        message: '请选择数据',
                        type: 'error'
                    });
                    return;
                }
                axios.post("http://yanferr.com:8080/qa/ques/delete",
                        JSON.stringify(this.selectIds), {
                            headers: {
                                'Content-Type': 'application/json'
                            }
                        })
                    .then(res => {
                        if (res && res.data.code === 0) {
                            this.$message({
                                showClose: true,
                                message: '删除成功',
                                type: 'success'
                            });
                            this.search = "";
                            this.getDataList();
                        } else {
                            console.log(res)
                            this.$message({
                                showClose: true,
                                message: res.data.data,
                                type: 'error'
                            })
                        };
                    }).catch(function (error) {
                        console.log(error);
                    });

                this.getDataList();
            },
            // input监听esc
            esc() {
                this.search = "";
            },
            // 修改答案
            updateAnswer() {
                axios.post('http://yanferr.com:8080/qa/answer/update', {
                    answerId: this.answerId,
                    answer: this.answer
                }).then(res => {
                    if (res && res.data.code === 0) {
                        this.$message({
                            showClose: true,
                            message: '修改成功',
                            type: 'success'
                        });
                    } else {
                        this.$message({
                            showClose: true,
                            message: res.data.data,
                            type: 'error'
                        })
                    };
                    this.showAnswerDialog = false;
                }).catch(function (error) {
                    console.log(error);
                });
            },
            rightClick() {
                alert("dsf")
            },
            dblclick() {
                document.location.href = '/index.html';
            },
            submit() {
                // http://yanferr.com:8080/qa/ques/save
                axios.post('http://yanferr.com:8080/qa/ques/save', {
                    quesId: this.quesId,
                    answerId: this.answerId,
                    ques: this.ques,
                    scene: this.scene,
                    answer: this.answer,
                }).then(res => { // 必须要用箭头函数
                    if (res && res.data.code === 0) {
                        this.$message({
                            message: '添加成功',
                            type: 'success'
                        });
                        location.reload();
                    } else {
                        alert("添加失败")
                    }
                }).catch(function (error) {
                    alert("添加失败")
                });
            },
            clickToSubmit() {
                if (this.ques.trim().length === 0) {
                    this.$message({
                        center: true,
                        message: '=>  问题不能为空 ',
                        type: 'error'
                    });
                    return;
                }
                if (this.answer.trim().length === 0) {
                    this.$message({
                        center: true,
                        message: '=>  答案不能为空 ',
                        type: 'error'
                    });
                    return;
                }
                this.submit();
            },
            getDataList() {
                axios.get('http://yanferr.com:8080/qa/ques/list')
                    .then(response => {
                        this.tableData = response.data.page.list;
                        console.log(this.tableData)
                    })
                    .catch(function (error) { // 请求失败处理
                        console.log(error);
                    });
            },
            //行单击事件
            rowClick(row, column, event) {
                this.quesId = row.quesId;
                this.drawer = true;
                this.answerId = row.answerId;
                this.scene = row.scene;
                this.ques = row.ques;
                this.getAnswerById(this.answerId);
                return false;
            },
            getAnswerById(answerId) {
                axios.get(`http://yanferr.com:8080/qa/answer/info/${answerId}`)
                    .then(response => {
                        this.answer = response.data.answer.answer;
                    })
                    .catch(function (error) { // 请求失败处理
                        console.log(error);
                    });
            },
            showSearch() {
                // 获取当前滚动条向下滚动的距离
                let scrollTop = document.documentElement.scrollTop || document.body.scrollTop;
                // 当页面滚动到高度300px处时，显示搜索框
                if (scrollTop > 50) {
                    this.showFixedSearch = true;
                } else {
                    this.showFixedSearch = false;
                }
            },
        },
        mounted() {
            this.getDataList();



            if (/Android|webOS|iPhone|iPod|BlackBerry/i.test(navigator.userAgent)) {
                this.isPhone = true;
                this.direction = "btt"; // 抽屉方向
                // window.location.href = "mindex.html";

            } else {
                this.isPhone = false;
                this.direction = "rtl";
                $(document).ready(function () {
                    $(".el-card__body,.el-main").css("width", "95%");
                });
            }
            // 监听页面滚动事件
            // window.addEventListener("scroll", this.showSearch);


        }
    })
</script>
<style scoped>
    .el-card {
        border-radius: 40px;
    }

    .el-card__body,
    .el-main {
        width: 89%;
    }

    .box-card-windows {
        margin: 1% auto 100px;
        display: table;
    }

    .box-card-phone {
        margin: 5% auto 100px;
        display: table;
    }

    .el-drawer__body {
        padding: 15px;
        width: 93%;
    }

    .submitdiv {
        height: 45px;
        width: auto;
        margin-top: 20px;
    }

    .el-select .el-input {
        width: 130px;
    }

    .input-with-select .el-input-group__prepend {
        background-color: #fff;
    }

    .toindex {
        height: 10px;
        width: 10px;
        display: block;
    }

    input {
        border-top: none;
        border-left: none;
        border-right: none;
        outline: none;
        /* 光标消失 */
        color: transparent;
        text-shadow: 0px 0px 0px #333;
        width: 100px;
        height: 7px;
        font-size: 5px;
    }


    .search {
        position: fixed;
        left: 60%;
        border: #fff;
    }
</style>

</html>